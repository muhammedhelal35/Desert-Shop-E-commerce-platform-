<%- include('../../partials/_admin-navbar') %>
<main class="admin-container fade-in">
  <header class="admin-header">
    <h1><i class="fas fa-edit"></i> Edit Product</h1>
    <p>Update product information</p>
  </header>
  <div class="product-form fade-in">
    <form action="/admin/products/<%= product._id %>" method="POST" enctype="multipart/form-data" autocomplete="off">
      <div class="form-group">
        <label for="name">Product Name *</label>
        <input type="text" id="name" name="name" class="form-control" value="<%= product.name %>" required autocomplete="off">
      </div>
      <div class="form-group">
        <label for="description">Description</label>
        <textarea id="description" name="description" class="form-control" rows="4"><%= product.description %></textarea>
      </div>
      <div class="form-group">
        <label for="price">Price *</label>
        <input type="number" id="price" name="price" class="form-control" step="0.01" min="0" value="<%= product.price %>" required>
      </div>
      <div class="form-group">
        <label for="category">Category *</label>
        <select id="category" name="category" class="form-control" required>
          <option value="">Select a category</option>
          <option value="Cakes" <%= product.category === 'Cakes' ? 'selected' : '' %>>Cakes</option>
          <option value="Cookies" <%= product.category === 'Cookies' ? 'selected' : '' %>>Cookies</option>
          <option value="Ice Cream" <%= product.category === 'Ice Cream' ? 'selected' : '' %>>Ice Cream</option>
          <option value="Pastries" <%= product.category === 'Pastries' ? 'selected' : '' %>>Pastries</option>
          <option value="Pies" <%= product.category === 'Pies' ? 'selected' : '' %>>Pies</option>
          <option value="Breads" <%= product.category === 'Breads' ? 'selected' : '' %>>Breads</option>
          <option value="Desserts" <%= product.category === 'Desserts' ? 'selected' : '' %>>Desserts</option>
          <option value="Beverages" <%= product.category === 'Beverages' ? 'selected' : '' %>>Beverages</option>
          <option value="Other" <%= product.category === 'Other' ? 'selected' : '' %>>Other</option>
        </select>
      </div>
      <div class="form-group">
        <label for="stock">Stock Quantity *</label>
        <input type="number" id="stock" name="stock" class="form-control" min="0" value="<%= product.stock %>" required>
      </div>
      <div class="form-group">
        <label for="image">Product Image</label>
        <input type="file" id="image" name="image" class="form-control" accept="image/*">
        <small class="form-text">Supported formats: JPG, PNG, GIF, WebP (max 5MB)</small>
        <% if (product.image) { %>
          <div class="current-image">
            <p><strong>Current Image:</strong></p>
            <img src="<%= product.image %>" alt="<%= product.name %>" style="max-width:200px;max-height:150px;object-fit:cover;border-radius:8px;box-shadow:0 2px 8px rgba(120,120,180,0.08);">
          </div>
        <% } %>
      </div>
      <div class="form-group checkbox-group">
        <input type="checkbox" id="isActive" name="isActive" class="form-control" <%= product.isActive ? 'checked' : '' %>>
        <label for="isActive">Active (available for purchase)</label>
      </div>
      <div class="form-actions">
        <button type="submit" class="btn btn-primary" aria-label="Update Product"><i class="fas fa-save"></i> Update Product</button>
        <a href="/admin/products" class="btn btn-secondary" aria-label="Cancel"><i class="fas fa-arrow-left"></i> Cancel</a>
      </div>
    </form>
  </div>
</main>
<script src="/js/main.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.querySelector('form');
  const nameInput = document.getElementById('name');
  const priceInput = document.getElementById('price');
  const stockInput = document.getElementById('stock');
  const categorySelect = document.getElementById('category');
  form.addEventListener('submit', function(e) {
    let isValid = true;
    let errorMessage = '';
    if (!nameInput.value.trim()) {
      errorMessage += 'Product name is required.\n';
      isValid = false;
    }
    if (!priceInput.value || priceInput.value <= 0) {
      errorMessage += 'Price must be greater than 0.\n';
      isValid = false;
    }
    if (!stockInput.value || stockInput.value < 0) {
      errorMessage += 'Stock must be 0 or more.\n';
      isValid = false;
    }
    if (!categorySelect.value) {
      errorMessage += 'Category is required.\n';
      isValid = false;
    }
    if (!isValid) {
      alert(errorMessage);
      e.preventDefault();
    }
  });
});
</script>
<!-- All admin styles are now in style.css -->