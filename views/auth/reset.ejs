<div class="auth-container fade-in">
  <div class="auth-card card fade-in">
    <div class="auth-header">
      <h1 class="auth-title mb-2">Reset Password</h1>
      <% if (success_msg && success_msg.length > 0) { %>
        <div class="alert-success card fade-in mb-2"><%= success_msg %></div>
      <% } %>
      <% if (error_msg && error_msg.length > 0) { %>
        <div class="alert-danger card fade-in mb-2"><%= error_msg %></div>
      <% } %>
    </div>
    <% if (!token) { %>
      <div class="alert-warning card fade-in mb-2">
        <strong>Invalid or Expired Link</strong>
        <p>The password reset link is invalid or has expired. Please request a new one.</p>
        <a href="/auth/forgot" class="btn btn-secondary mt-2"><i class="fas fa-redo"></i> Request New Reset Link</a>
      </div>
    <% } else { %>
      <form method="POST" action="/auth/reset/<%= token %>" class="auth-form fade-in" autocomplete="off">
        <div class="form-group mb-2">
          <label for="password">New Password</label>
          <div class="password-input">
            <input type="password" class="form-control" id="password" name="password" required minlength="8" autocomplete="new-password">
            <button type="button" class="toggle-password" aria-label="Show password"><i class="fas fa-eye"></i></button>
          </div>
          <div id="password-strength-container" class="password-strength-container">
            <div id="password-strength" class="password-strength"></div>
          </div>
          <small class="form-text text-muted">Must be at least 8 characters with uppercase, lowercase, number, and special character</small>
        </div>
        <div class="form-group mb-2">
          <label for="confirmPassword">Confirm New Password</label>
          <div class="password-input">
            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required autocomplete="new-password">
            <button type="button" class="toggle-password" aria-label="Show password"><i class="fas fa-eye"></i></button>
          </div>
        </div>
        <button type="submit" class="btn btn-primary w-100 mt-2"><i class="fas fa-key"></i> Reset Password</button>
      </form>
    <% } %>
    <div class="auth-footer fade-in mt-2">
      <a href="/auth/login"><i class="fas fa-arrow-left"></i> Back to Login</a>
    </div>
  </div>
</div>
<script src="/js/main.js"></script>
<script>
document.querySelectorAll('.toggle-password').forEach(button => {
  button.addEventListener('click', function() {
    const input = this.previousElementSibling;
    const icon = this.querySelector('i');
    if (input.type === 'password') {
      input.type = 'text';
      icon.classList.replace('fa-eye', 'fa-eye-slash');
    } else {
      input.type = 'password';
      icon.classList.replace('fa-eye-slash', 'fa-eye');
    }
  });
});
// Password strength indicator
const passwordInput = document.getElementById('password');
const strengthBar = document.getElementById('password-strength');
const strengthContainer = document.getElementById('password-strength-container');
if (passwordInput && strengthBar && strengthContainer) {
  passwordInput.addEventListener('input', function() {
    const password = this.value;
    if (password.length > 0) {
      strengthContainer.style.display = 'block';
    } else {
      strengthContainer.style.display = 'none';
      return;
    }
    let strength = 0;
    if (password.length >= 8) strength += 25;
    if (/[A-Z]/.test(password)) strength += 25;
    if (/[a-z]/.test(password)) strength += 25;
    if (/[0-9!@#$%^&*(),.?":{}|<>]/.test(password)) strength += 25;
    strengthBar.style.width = strength + '%';
    if (strength <= 25) strengthBar.style.backgroundColor = '#dc3545';
    else if (strength <= 50) strengthBar.style.backgroundColor = '#ffc107';
    else if (strength <= 75) strengthBar.style.backgroundColor = '#17a2b8';
    else strengthBar.style.backgroundColor = '#28a745';
  });
}
// Password confirmation validation
const confirmPasswordInput = document.getElementById('confirmPassword');
if (confirmPasswordInput && passwordInput) {
  confirmPasswordInput.addEventListener('input', function() {
    const password = passwordInput.value;
    const confirmPassword = this.value;
    if (confirmPassword && password !== confirmPassword) {
      this.setCustomValidity('Passwords do not match');
    } else {
      this.setCustomValidity('');
    }
  });
}
</script> 