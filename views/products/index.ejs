<div class="product-page-container">
    <!-- Search and Filters -->
    <form action="/products" method="GET" class="product-search-form fade-in" style="margin-bottom:2.5rem;display:flex;flex-wrap:wrap;gap:1.2rem;align-items:center;">
        <input type="text" name="search" class="search-bar" placeholder="Search for desserts" value="<%= search || '' %>" style="max-width:340px;flex:1 1 240px;">
        <div class="category-filters" style="display:flex;gap:0.7rem;flex-wrap:wrap;">
            <a href="/products" class="category-pill <%= !category ? 'active' : '' %>">All</a>
            <a href="/products?category=Cakes" class="category-pill <%= category === 'Cakes' ? 'active' : '' %>">Cakes</a>
            <a href="/products?category=Cookies" class="category-pill <%= category === 'Cookies' ? 'active' : '' %>">Cookies</a>
            <a href="/products?category=Ice%20Cream" class="category-pill <%= category === 'Ice Cream' ? 'active' : '' %>">Ice Cream</a>
        </div>
    </form>
    
    <!-- Product Row -->
    <div class="product-row fade-in" style="margin-bottom:2.5rem;">
        <% if (products && products.length > 0) { %>
            <div class="product-scroll-container" style="display:flex;gap:1.5rem;overflow-x:auto;padding:1rem 0;scrollbar-width:thin;scrollbar-color:var(--accent) transparent;">
                <% products.forEach(product => { %>
                <div class="product-card card fade-in" style="padding:1.5rem 1.2rem;min-width:280px;max-width:320px;flex:0 0 auto;display:flex;flex-direction:column;align-items:center;background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.3);">
                    <img src="<%= product.image %>" alt="<%= product.name %>" class="rounded shadow product-image" style="width:100%;height:200px;object-fit:cover;border-radius:1.2rem;box-shadow:0 4px 18px rgba(34,197,94,0.10);margin-bottom:1.2rem;transition:transform 0.3s ease;">
                    <h5 style="font-size:1.13rem;font-weight:700;margin-bottom:0.5rem;text-align:center;color:var(--text);"> <%= product.name %> </h5>
                    <p class="text-muted" style="font-size:0.95rem;margin-bottom:0.7rem;text-align:center;line-height:1.4;"> <%= product.description.substring(0, 80) %> </p>
                    <span style="color:#22c55e;font-weight:700;font-size:1.2rem;margin-bottom:1rem;">$<%= product.price %></span>
                    <a href="/products/<%= product._id %>" class="btn-main w-100" style="font-size:1rem;padding:0.9rem 0;margin-top:auto;text-decoration:none;display:inline-block;">View Details</a>
                </div>
                <% }); %>
            </div>
        <% } else { %>
        <div class="text-center fade-in">
            <p>No products found.</p>
        </div>
        <% } %>
    </div>
    
    <!-- Pagination -->
    <% if (totalPages > 1) { %>
    <nav class="pagination-nav mt-4 fade-in" style="display:flex;justify-content:center;">
        <ul class="pagination-list" style="display:flex;gap:0.5rem;list-style:none;padding:0;">
            <li class="pagination-item <%= currentPage === 1 ? 'disabled' : '' %>">
                <a href="?page=<%= currentPage - 1 %>&category=<%= category %>&sort=<%= sort %>&search=<%= search %>" class="pagination-pill">&lt;</a>
            </li>
            <% for(let i = 1; i <= totalPages; i++) { %>
            <li class="pagination-item <%= currentPage === i ? 'active' : '' %>">
                <a href="?page=<%= i %>&category=<%= category %>&sort=<%= sort %>&search=<%= search %>" class="pagination-pill <%= currentPage === i ? 'active' : '' %>"><%= i %></a>
            </li>
            <% } %>
            <li class="pagination-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                <a href="?page=<%= currentPage + 1 %>&category=<%= category %>&sort=<%= sort %>&search=<%= search %>" class="pagination-pill">&gt;</a>
            </li>
        </ul>
    </nav>
    <% } %>
</div>

<style>
.product-page-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 1rem;
}

.product-search-form {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(20px);
    padding: 1.5rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.search-bar {
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid var(--border);
    border-radius: var(--radius-pill);
    padding: 1rem 1.5rem;
    font-size: 1rem;
    transition: all var(--transition);
}

.search-bar:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 4px rgba(255, 107, 157, 0.1);
    outline: none;
}

.category-filters {
    display: flex;
    gap: 0.8rem;
    flex-wrap: wrap;
}

.category-pill {
    display: inline-block;
    padding: 0.7rem 1.5rem;
    border-radius: var(--radius-pill);
    background: var(--accent-bg);
    color: var(--text);
    font-weight: 600;
    font-size: 0.95rem;
    border: none;
    text-decoration: none;
    transition: all var(--transition);
    cursor: pointer;
}

.category-pill.active, .category-pill:hover {
    background: var(--accent);
    color: white;
    box-shadow: 0 2px 8px rgba(255, 107, 157, 0.3);
}

.product-row {
    margin-bottom: 3rem;
}

.product-scroll-container {
    display: flex;
    gap: 1.5rem;
    overflow-x: auto;
    padding: 1rem 0;
    scrollbar-width: thin;
    scrollbar-color: var(--accent) transparent;
    -webkit-overflow-scrolling: touch;
}

.product-scroll-container::-webkit-scrollbar {
    height: 8px;
}

.product-scroll-container::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 4px;
}

.product-scroll-container::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 4px;
}

.product-scroll-container::-webkit-scrollbar-thumb:hover {
    background: var(--accent-dark);
}

.product-card {
    padding: 1.5rem 1.2rem;
    min-width: 280px;
    max-width: 320px;
    flex: 0 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    transition: all var(--transition);
    position: relative;
    overflow: hidden;
}

.product-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--accent), var(--secondary));
    transform: scaleX(0);
    transition: transform var(--transition);
}

.product-card:hover::before {
    transform: scaleX(1);
}

.product-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: var(--shadow-lg);
}

.product-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: var(--radius);
    box-shadow: var(--shadow-soft);
    transition: transform var(--transition);
}

.product-card:hover .product-image {
    transform: scale(1.05);
}

.btn-main {
    background: linear-gradient(135deg, var(--accent), var(--accent-dark));
    color: white;
    border: none;
    border-radius: var(--radius-pill);
    padding: 0.9rem 1.5rem;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition);
    text-decoration: none;
    display: inline-block;
    text-align: center;
    width: 100%;
}

.btn-main:hover {
    background: linear-gradient(135deg, var(--accent-dark), var(--accent));
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    color: white;
    text-decoration: none;
}

.pagination-nav {
    display: flex;
    justify-content: center;
    margin-top: 3rem;
}

.pagination-list {
    display: flex;
    gap: 0.5rem;
    list-style: none;
    padding: 0;
    margin: 0;
}

.pagination-pill {
    display: inline-block;
    padding: 0.7rem 1.2rem;
    border-radius: var(--radius-pill);
    background: var(--accent-bg);
    color: var(--text);
    font-weight: 600;
    font-size: 0.95rem;
    border: none;
    text-decoration: none;
    transition: all var(--transition);
    cursor: pointer;
}

.pagination-pill.active, .pagination-pill:hover {
    background: var(--accent);
    color: white;
    box-shadow: 0 2px 8px rgba(255, 107, 157, 0.3);
}

.pagination-item.disabled .pagination-pill {
    background: var(--primary-dark);
    color: var(--muted);
    cursor: not-allowed;
    pointer-events: none;
}

/* Responsive Design */
@media (max-width: 768px) {
    .product-page-container {
        padding: 0 0.5rem;
    }
    
    .product-search-form {
        padding: 1rem;
        flex-direction: column;
        align-items: stretch;
    }
    
    .search-bar {
        max-width: none;
        flex: none;
    }
    
    .category-filters {
        justify-content: center;
    }
    
    .product-scroll-container {
        gap: 1rem;
        padding: 0.5rem 0;
    }
    
    .product-card {
        min-width: 250px;
        padding: 1rem;
    }
    
    .product-image {
        height: 160px;
    }
}

@media (max-width: 480px) {
    .product-card {
        min-width: 220px;
        padding: 0.8rem;
    }
    
    .product-image {
        height: 140px;
    }
    
    .category-pill {
        padding: 0.6rem 1.2rem;
        font-size: 0.9rem;
    }
}
</style>