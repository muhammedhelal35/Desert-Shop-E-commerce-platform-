<%- include('../partials/_flash') %>
<div class="order-details-container fade-in">
  <div class="order-details-header d-flex justify-between align-center mb-2">
    <h1>Order Details</h1>
    <a href="/orders" class="btn-secondary"><i class="fas fa-arrow-left"></i> Back to Orders</a>
  </div>
  <div class="order-details-grid">
    <!-- Order Information -->
    <div class="order-info-col">
      <div class="card fade-in mb-2">
        <div class="card-header"><h5>Order Information</h5></div>
        <div class="card-body">
          <div class="mb-2"><strong>Order ID:</strong> <%= order._id %></div>
          <div class="mb-2"><strong>Order Date:</strong> <%= new Date(order.createdAt).toLocaleString() %></div>
          <div class="mb-2"><strong>Status:</strong> <span class="status-badge status-<%= order.status.toLowerCase() %>"><%= order.status.charAt(0).toUpperCase() + order.status.slice(1) %></span></div>
          <div class="mb-2"><strong>Payment Method:</strong> <%= order.paymentMethod.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) %></div>
          <div class="mb-2"><strong>Payment Status:</strong> <span class="status-badge status-<%= order.paymentStatus.toLowerCase() %>"><%= order.paymentStatus.charAt(0).toUpperCase() + order.paymentStatus.slice(1) %></span></div>
          <% if (order.paymentDetails && order.paymentDetails.transactionId) { %>
            <div class="mb-2"><strong>Transaction ID:</strong> <%= order.paymentDetails.transactionId %></div>
          <% } %>
        </div>
      </div>
      <div class="card fade-in mb-2">
        <div class="card-header"><h5>Order Items</h5></div>
        <div class="card-body">
          <% order.items.forEach(item => { %>
            <div class="order-item-row d-flex align-center mb-2">
              <% if (item.product && item.product.image) { %>
                <img src="/images/products/<%= item.product.image %>" alt="<%= item.product.name %>" class="order-item-img rounded shadow">
              <% } else { %>
                <div class="order-item-img order-item-img-placeholder rounded shadow"><i class="fas fa-image text-muted"></i></div>
              <% } %>
              <div class="order-item-info">
                <h6 class="mb-1"><%= item.product ? item.product.name : 'Product not found' %></h6>
                <div class="text-muted"><%= item.product ? item.product.description : 'Description not available' %></div>
              </div>
              <span class="order-item-qty">x<%= item.quantity %></span>
              <span class="order-item-price">$<%= (item.price * item.quantity).toFixed(2) %></span>
            </div>
          <% }) %>
        </div>
      </div>
      <% if (order.shippingAddress) { %>
        <div class="card fade-in mb-2">
          <div class="card-header"><h5>Shipping Address</h5></div>
          <div class="card-body">
            <div class="text-muted"><%= order.shippingAddress %></div>
          </div>
        </div>
      <% } %>
    </div>
    <!-- Order Summary -->
    <div class="order-summary-col">
      <div class="card fade-in">
        <div class="card-header"><h5>Order Summary</h5></div>
        <div class="card-body">
          <div class="d-flex justify-between mb-2"><span>Subtotal:</span><span>$<%= order.subtotal.toFixed(2) %></span></div>
          <div class="d-flex justify-between mb-2"><span>Tax (10%):</span><span>$<%= order.tax.toFixed(2) %></span></div>
          <div class="d-flex justify-between mb-2"><span>Shipping:</span><span>$<%= order.shipping.toFixed(2) %></span></div>
          <hr>
          <div class="d-flex justify-between mb-2"><strong>Total:</strong><strong class="text-primary">$<%= order.finalAmount.toFixed(2) %></strong></div>
          <% if (order.status === 'pending') { %>
            <form action="/orders/<%= order._id %>/cancel" method="POST" class="mt-2">
              <button type="submit" class="btn-main w-100" onclick="return confirm('Are you sure you want to cancel this order?')">Cancel Order</button>
            </form>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
.order-details-container { max-width: 1100px; margin: 0 auto; padding: 2rem 1rem; }
.order-details-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
.order-details-grid { display: flex; gap: 2.5rem; flex-wrap: wrap; }
.order-info-col { flex: 2 1 400px; min-width: 320px; }
.order-summary-col { flex: 1 1 260px; min-width: 260px; }
.card { background: #fff; border-radius: var(--radius); box-shadow: var(--shadow); margin-bottom: 1.2rem; }
.card-header { background: var(--primary-light); border-radius: var(--radius) var(--radius) 0 0; padding: 1rem 1.2rem; font-weight: 700; color: var(--primary-dark); border-bottom: 1px solid var(--border); }
.card-body { padding: 1.2rem 1.2rem; }
.status-badge { padding: 0.3em 1em; border-radius: 12px; font-size: 0.95em; font-weight: 600; background: var(--accent-light); color: var(--primary-dark); }
.status-badge.status-completed { background: #b8e7e0; color: #17694a; }
.status-badge.status-pending { background: #ffe082; color: #b97a95; }
.status-badge.status-cancelled { background: #ffcdd2; color: #b91c1c; }
.order-item-row { display: flex; align-items: center; gap: 1.2rem; border-bottom: 1px solid var(--border); padding: 1rem 0; }
.order-item-row:last-child { border-bottom: none; }
.order-item-img { width: 60px; height: 60px; object-fit: cover; border-radius: var(--radius); box-shadow: var(--shadow); background: #fff; display: flex; align-items: center; justify-content: center; }
.order-item-img-placeholder { background: var(--primary-light); color: var(--muted); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
.order-item-info { flex: 1; }
.order-item-qty { font-size: 1rem; color: var(--primary-dark); margin-right: 1rem; }
.order-item-price { font-size: 1.1rem; font-weight: 700; color: var(--primary); }
.mt-2 { margin-top: 1rem; } .mb-2 { margin-bottom: 1rem; }
.text-muted { color: var(--muted); }
.w-100 { width: 100%; }
@media (max-width: 900px) { .order-details-grid { flex-direction: column; gap: 1.5rem; } .order-details-header { flex-direction: column; gap: 1rem; } }
</style> 